services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

    # Service aliases for better developer experience
    ai_dev_assistant.code_analyzer: '@Aria1991\AIDevAssistantBundle\Service\CodeAnalyzer'
    ai_dev_assistant.ai_manager: '@Aria1991\AIDevAssistantBundle\Service\AIManager'
    ai_dev_assistant.cache: '@Aria1991\AIDevAssistantBundle\Service\CacheService'

    Aria1991\AIDevAssistantBundle\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/AIDevAssistantBundle.php'

    # AI Providers with priority tags for ordered fallback
    Aria1991\AIDevAssistantBundle\Service\Provider\OpenAIProvider:
        arguments:
            $httpClient: '@http_client'
            $apiKey: '%env(default::OPENAI_API_KEY)%'
            $model: 'gpt-4'
            $maxTokens: 4000
        tags:
            - { name: 'ai_dev_assistant.provider', priority: 100 }

    Aria1991\AIDevAssistantBundle\Service\Provider\AnthropicProvider:
        arguments:
            $httpClient: '@http_client'
            $apiKey: '%env(default::ANTHROPIC_API_KEY)%'
            $model: 'claude-3-sonnet-20240229'
            $maxTokens: 4000
        tags:
            - { name: 'ai_dev_assistant.provider', priority: 80 }

    Aria1991\AIDevAssistantBundle\Service\Provider\GoogleProvider:
        arguments:
            $httpClient: '@http_client'
            $apiKey: '%env(default::GOOGLE_AI_API_KEY)%'
            $model: 'gemini-pro'
        tags:
            - { name: 'ai_dev_assistant.provider', priority: 60 }

    # AI Manager - simplified for CI stability
    Aria1991\AIDevAssistantBundle\Service\AIManager:
        arguments:
            $providers: 
                - '@Aria1991\AIDevAssistantBundle\Service\Provider\OpenAIProvider'
                - '@Aria1991\AIDevAssistantBundle\Service\Provider\AnthropicProvider' 
                - '@Aria1991\AIDevAssistantBundle\Service\Provider\GoogleProvider'

    # Code Analyzers with service tags and priorities
    Aria1991\AIDevAssistantBundle\Service\Analyzer\SecurityAnalyzer:
        tags: 
            - { name: 'ai_dev_assistant.analyzer', priority: 100 }
    Aria1991\AIDevAssistantBundle\Service\Analyzer\QualityAnalyzer:
        tags: 
            - { name: 'ai_dev_assistant.analyzer', priority: 90 }
    Aria1991\AIDevAssistantBundle\Service\Analyzer\PerformanceAnalyzer:
        tags: 
            - { name: 'ai_dev_assistant.analyzer', priority: 80 }
    Aria1991\AIDevAssistantBundle\Service\Analyzer\DocumentationAnalyzer:
        tags: 
            - { name: 'ai_dev_assistant.analyzer', priority: 70 }

    # Main Code Analyzer Service - simplified for CI stability  
    Aria1991\AIDevAssistantBundle\Service\CodeAnalyzer:
        arguments:
            $analyzers:
                - '@Aria1991\AIDevAssistantBundle\Service\Analyzer\SecurityAnalyzer'
                - '@Aria1991\AIDevAssistantBundle\Service\Analyzer\QualityAnalyzer'
                - '@Aria1991\AIDevAssistantBundle\Service\Analyzer\PerformanceAnalyzer'
                - '@Aria1991\AIDevAssistantBundle\Service\Analyzer\DocumentationAnalyzer'
            $cacheService: '@Aria1991\AIDevAssistantBundle\Service\CacheService'

    # Cache Service
    Aria1991\AIDevAssistantBundle\Service\CacheService:
        arguments:
            $cache: '@cache.app'
            $ttl: 3600
            $enabled: true

    # Rate Limiter
    Aria1991\AIDevAssistantBundle\Service\RateLimiter:
        arguments:
            $cache: '@cache.app'

    # Commands
    Aria1991\AIDevAssistantBundle\Command\AnalyzeCodeCommand:
        tags:
            - { name: 'console.command' }

    Aria1991\AIDevAssistantBundle\Command\ConfigTestCommand:
        tags:
            - { name: 'console.command' }

    Aria1991\AIDevAssistantBundle\Command\InstallCommand:
        arguments:
            $projectDir: '%kernel.project_dir%'
        tags:
            - { name: 'console.command' }

    # Health Check Command (v1.2+)
    Aria1991\AIDevAssistantBundle\Command\HealthCheckCommand:
        tags:
            - { name: 'console.command' }

    # Advanced Cache Service (v1.3+) - simplified configuration
    Aria1991\AIDevAssistantBundle\Service\AdvancedCacheService:
        arguments:
            $cache: '@cache.app'
            $logger: '@?logger'

    # WebProfiler Data Collector (v1.4+) - conditional loading
    # Note: Only loads when WebProfiler bundle is available
    # Aria1991\AIDevAssistantBundle\DataCollector\AIAnalysisDataCollector:
    #     arguments:
    #         $codeAnalyzer: '@Aria1991\AIDevAssistantBundle\Service\CodeAnalyzer'
    #         $aiManager: '@Aria1991\AIDevAssistantBundle\Service\AIManager'
    #     tags:
    #         - { name: 'data_collector', template: 'profiler/ai_analysis.html.twig', id: 'ai_analysis', priority: 300 }
